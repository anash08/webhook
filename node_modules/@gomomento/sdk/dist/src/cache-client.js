"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SimpleCacheClient = exports.CacheClient = void 0;
const control_client_1 = require("./internal/control-client");
const data_client_1 = require("./internal/data-client");
const utils_1 = require("@gomomento/sdk-core/dist/src/internal/utils");
const AbstractCacheClient_1 = require("@gomomento/sdk-core/dist/src/internal/clients/cache/AbstractCacheClient");
const EAGER_CONNECITON_DEFAULT_TIMEOUT_SECONDS = 30;
/**
 * Momento Cache Client.
 *
 * Features include:
 * - Get, set, and delete data
 * - Create, delete, and list caches
 * - Create, revoke, and list signing keys
 */
class CacheClient extends AbstractCacheClient_1.AbstractCacheClient {
    /**
     * Creates an instance of CacheClient.
     * @param {CacheClientProps} props configuration and credentials for creating a CacheClient.
     */
    constructor(props) {
        const controlClient = new control_client_1.ControlClient({
            configuration: props.configuration,
            credentialProvider: props.credentialProvider,
        });
        const numClients = props.configuration
            .getTransportStrategy()
            .getGrpcConfig()
            .getNumClients();
        const dataClients = (0, utils_1.range)(numClients).map((_, id) => new data_client_1.DataClient(props, String(id)));
        super(controlClient, dataClients);
        this.notYetAbstractedControlClient = controlClient;
        this.logger = props.configuration.getLoggerFactory().getLogger(this);
        this.logger.info('Creating Momento CacheClient');
    }
    /**
     * Creates a new instance of CacheClient. If eagerConnectTimeout is present in the given props, the client will
     * eagerly create its connection to Momento. It will wait until the connection is established, or until the timout
     * runs out. It the timeout runs out, the client will be valid to use, but it may still be connecting in the background.
     * @param {EagerCacheClientProps} props configuration and credentials for creating a CacheClient.
     */
    static async create(props) {
        const client = new CacheClient(props);
        const timeout = props.eagerConnectTimeout !== undefined
            ? props.eagerConnectTimeout
            : EAGER_CONNECITON_DEFAULT_TIMEOUT_SECONDS;
        // client need to explicitly set the value as 0 to disable eager connection.
        if (props.eagerConnectTimeout !== 0) {
            await Promise.all(client.dataClients.map(dc => dc.connect(timeout)));
        }
        return client;
    }
    /**
     * Flushes / clears all the items of the given cache
     *
     * @param {string} cacheName - The cache to be flushed.
     * @returns {Promise<CacheFlush.Response>} -
     * {@link CacheFlush.Success} on success.
     * {@link CacheFlush.Error} on failure.
     */
    async flushCache(cacheName) {
        return await this.notYetAbstractedControlClient.flushCache(cacheName);
    }
    /**
     * Creates a Momento signing key.
     *
     * @param {number} ttlMinutes - The time to live in minutes until the Momento
     * signing key expires.
     * @returns {Promise<CreateSigningKey.Response>} -
     * {@link CreateSigningKey.Success} containing the key, key ID, endpoint, and
     * expiration date on success.
     * {@link CreateSigningKey.Error} on failure.
     */
    async createSigningKey(ttlMinutes) {
        const client = this.getNextDataClient();
        return await this.notYetAbstractedControlClient.createSigningKey(ttlMinutes, client.getEndpoint());
    }
    /**
     * Revokes a Momento signing key.
     *
     * @remarks
     * All tokens signed by this key will be invalid.
     *
     * @param {string} keyId - The ID of the key to revoke.
     * @returns {Promise<RevokeSigningKey.Response>} -
     * {@link RevokeSigningKey.Success} on success.
     * {@link RevokeSigningKey.Error} on failure.
     */
    async revokeSigningKey(keyId) {
        return await this.notYetAbstractedControlClient.revokeSigningKey(keyId);
    }
    /**
     * Lists all Momento signing keys for the provided auth token.
     *
     * @returns {Promise<ListSigningKeys.Response>} -
     * {@link ListSigningKeys.Success} containing the keys on success.
     * {@link ListSigningKeys.Error} on failure.
     */
    async listSigningKeys() {
        const client = this.getNextDataClient();
        return await this.notYetAbstractedControlClient.listSigningKeys(client.getEndpoint());
    }
    getNextDataClient() {
        const client = this.dataClients[this.nextDataClientIndex];
        this.nextDataClientIndex =
            (this.nextDataClientIndex + 1) % this.dataClients.length;
        return client;
    }
}
exports.CacheClient = CacheClient;
/**
 * @deprecated use {CacheClient} instead
 */
class SimpleCacheClient extends CacheClient {
}
exports.SimpleCacheClient = SimpleCacheClient;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FjaGUtY2xpZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2NhY2hlLWNsaWVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSw4REFBd0Q7QUFDeEQsd0RBQWtEO0FBU2xELHVFQUFrRTtBQUVsRSxpSEFBNEc7QUFFNUcsTUFBTSx3Q0FBd0MsR0FBRyxFQUFFLENBQUM7QUFDcEQ7Ozs7Ozs7R0FPRztBQUNILE1BQWEsV0FBWSxTQUFRLHlDQUFtQjtJQUdsRDs7O09BR0c7SUFDSCxZQUFZLEtBQXVCO1FBQ2pDLE1BQU0sYUFBYSxHQUFHLElBQUksOEJBQWEsQ0FBQztZQUN0QyxhQUFhLEVBQUUsS0FBSyxDQUFDLGFBQWE7WUFDbEMsa0JBQWtCLEVBQUUsS0FBSyxDQUFDLGtCQUFrQjtTQUM3QyxDQUFDLENBQUM7UUFFSCxNQUFNLFVBQVUsR0FBRyxLQUFLLENBQUMsYUFBYTthQUNuQyxvQkFBb0IsRUFBRTthQUN0QixhQUFhLEVBQUU7YUFDZixhQUFhLEVBQUUsQ0FBQztRQUNuQixNQUFNLFdBQVcsR0FBRyxJQUFBLGFBQUssRUFBQyxVQUFVLENBQUMsQ0FBQyxHQUFHLENBQ3ZDLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsSUFBSSx3QkFBVSxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FDN0MsQ0FBQztRQUNGLEtBQUssQ0FBQyxhQUFhLEVBQUUsV0FBVyxDQUFDLENBQUM7UUFFbEMsSUFBSSxDQUFDLDZCQUE2QixHQUFHLGFBQWEsQ0FBQztRQUVuRCxJQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDckUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsOEJBQThCLENBQUMsQ0FBQztJQUNuRCxDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSCxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUE0QjtRQUM5QyxNQUFNLE1BQU0sR0FBRyxJQUFJLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN0QyxNQUFNLE9BQU8sR0FDWCxLQUFLLENBQUMsbUJBQW1CLEtBQUssU0FBUztZQUNyQyxDQUFDLENBQUMsS0FBSyxDQUFDLG1CQUFtQjtZQUMzQixDQUFDLENBQUMsd0NBQXdDLENBQUM7UUFDL0MsNEVBQTRFO1FBQzVFLElBQUksS0FBSyxDQUFDLG1CQUFtQixLQUFLLENBQUMsRUFBRTtZQUNuQyxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQ2YsTUFBTSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBRSxFQUFpQixDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUNsRSxDQUFDO1NBQ0g7UUFDRCxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDO0lBRUQ7Ozs7Ozs7T0FPRztJQUNJLEtBQUssQ0FBQyxVQUFVLENBQUMsU0FBaUI7UUFDdkMsT0FBTyxNQUFNLElBQUksQ0FBQyw2QkFBNkIsQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDeEUsQ0FBQztJQUVEOzs7Ozs7Ozs7T0FTRztJQUNJLEtBQUssQ0FBQyxnQkFBZ0IsQ0FDM0IsVUFBa0I7UUFFbEIsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDeEMsT0FBTyxNQUFNLElBQUksQ0FBQyw2QkFBNkIsQ0FBQyxnQkFBZ0IsQ0FDOUQsVUFBVSxFQUNWLE1BQU0sQ0FBQyxXQUFXLEVBQUUsQ0FDckIsQ0FBQztJQUNKLENBQUM7SUFFRDs7Ozs7Ozs7OztPQVVHO0lBQ0ksS0FBSyxDQUFDLGdCQUFnQixDQUMzQixLQUFhO1FBRWIsT0FBTyxNQUFNLElBQUksQ0FBQyw2QkFBNkIsQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUMxRSxDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0ksS0FBSyxDQUFDLGVBQWU7UUFDMUIsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDeEMsT0FBTyxNQUFNLElBQUksQ0FBQyw2QkFBNkIsQ0FBQyxlQUFlLENBQzdELE1BQU0sQ0FBQyxXQUFXLEVBQUUsQ0FDckIsQ0FBQztJQUNKLENBQUM7SUFFUyxpQkFBaUI7UUFDekIsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FBQztRQUMxRCxJQUFJLENBQUMsbUJBQW1CO1lBQ3RCLENBQUMsSUFBSSxDQUFDLG1CQUFtQixHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDO1FBQzNELE9BQU8sTUFBb0IsQ0FBQztJQUM5QixDQUFDO0NBQ0Y7QUF0SEQsa0NBc0hDO0FBRUQ7O0dBRUc7QUFDSCxNQUFhLGlCQUFrQixTQUFRLFdBQVc7Q0FBRztBQUFyRCw4Q0FBcUQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbnRyb2xDbGllbnR9IGZyb20gJy4vaW50ZXJuYWwvY29udHJvbC1jbGllbnQnO1xuaW1wb3J0IHtEYXRhQ2xpZW50fSBmcm9tICcuL2ludGVybmFsL2RhdGEtY2xpZW50JztcbmltcG9ydCB7XG4gIENyZWF0ZVNpZ25pbmdLZXksXG4gIExpc3RTaWduaW5nS2V5cyxcbiAgUmV2b2tlU2lnbmluZ0tleSxcbiAgQ2FjaGVGbHVzaCxcbiAgTW9tZW50b0xvZ2dlcixcbn0gZnJvbSAnLic7XG5pbXBvcnQge0NhY2hlQ2xpZW50UHJvcHMsIEVhZ2VyQ2FjaGVDbGllbnRQcm9wc30gZnJvbSAnLi9jYWNoZS1jbGllbnQtcHJvcHMnO1xuaW1wb3J0IHtyYW5nZX0gZnJvbSAnQGdvbW9tZW50by9zZGstY29yZS9kaXN0L3NyYy9pbnRlcm5hbC91dGlscyc7XG5pbXBvcnQge0lDYWNoZUNsaWVudH0gZnJvbSAnQGdvbW9tZW50by9zZGstY29yZS9kaXN0L3NyYy9jbGllbnRzL0lDYWNoZUNsaWVudCc7XG5pbXBvcnQge0Fic3RyYWN0Q2FjaGVDbGllbnR9IGZyb20gJ0Bnb21vbWVudG8vc2RrLWNvcmUvZGlzdC9zcmMvaW50ZXJuYWwvY2xpZW50cy9jYWNoZS9BYnN0cmFjdENhY2hlQ2xpZW50JztcblxuY29uc3QgRUFHRVJfQ09OTkVDSVRPTl9ERUZBVUxUX1RJTUVPVVRfU0VDT05EUyA9IDMwO1xuLyoqXG4gKiBNb21lbnRvIENhY2hlIENsaWVudC5cbiAqXG4gKiBGZWF0dXJlcyBpbmNsdWRlOlxuICogLSBHZXQsIHNldCwgYW5kIGRlbGV0ZSBkYXRhXG4gKiAtIENyZWF0ZSwgZGVsZXRlLCBhbmQgbGlzdCBjYWNoZXNcbiAqIC0gQ3JlYXRlLCByZXZva2UsIGFuZCBsaXN0IHNpZ25pbmcga2V5c1xuICovXG5leHBvcnQgY2xhc3MgQ2FjaGVDbGllbnQgZXh0ZW5kcyBBYnN0cmFjdENhY2hlQ2xpZW50IGltcGxlbWVudHMgSUNhY2hlQ2xpZW50IHtcbiAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXI6IE1vbWVudG9Mb2dnZXI7XG4gIHByaXZhdGUgcmVhZG9ubHkgbm90WWV0QWJzdHJhY3RlZENvbnRyb2xDbGllbnQ6IENvbnRyb2xDbGllbnQ7XG4gIC8qKlxuICAgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIENhY2hlQ2xpZW50LlxuICAgKiBAcGFyYW0ge0NhY2hlQ2xpZW50UHJvcHN9IHByb3BzIGNvbmZpZ3VyYXRpb24gYW5kIGNyZWRlbnRpYWxzIGZvciBjcmVhdGluZyBhIENhY2hlQ2xpZW50LlxuICAgKi9cbiAgY29uc3RydWN0b3IocHJvcHM6IENhY2hlQ2xpZW50UHJvcHMpIHtcbiAgICBjb25zdCBjb250cm9sQ2xpZW50ID0gbmV3IENvbnRyb2xDbGllbnQoe1xuICAgICAgY29uZmlndXJhdGlvbjogcHJvcHMuY29uZmlndXJhdGlvbixcbiAgICAgIGNyZWRlbnRpYWxQcm92aWRlcjogcHJvcHMuY3JlZGVudGlhbFByb3ZpZGVyLFxuICAgIH0pO1xuXG4gICAgY29uc3QgbnVtQ2xpZW50cyA9IHByb3BzLmNvbmZpZ3VyYXRpb25cbiAgICAgIC5nZXRUcmFuc3BvcnRTdHJhdGVneSgpXG4gICAgICAuZ2V0R3JwY0NvbmZpZygpXG4gICAgICAuZ2V0TnVtQ2xpZW50cygpO1xuICAgIGNvbnN0IGRhdGFDbGllbnRzID0gcmFuZ2UobnVtQ2xpZW50cykubWFwKFxuICAgICAgKF8sIGlkKSA9PiBuZXcgRGF0YUNsaWVudChwcm9wcywgU3RyaW5nKGlkKSlcbiAgICApO1xuICAgIHN1cGVyKGNvbnRyb2xDbGllbnQsIGRhdGFDbGllbnRzKTtcblxuICAgIHRoaXMubm90WWV0QWJzdHJhY3RlZENvbnRyb2xDbGllbnQgPSBjb250cm9sQ2xpZW50O1xuXG4gICAgdGhpcy5sb2dnZXIgPSBwcm9wcy5jb25maWd1cmF0aW9uLmdldExvZ2dlckZhY3RvcnkoKS5nZXRMb2dnZXIodGhpcyk7XG4gICAgdGhpcy5sb2dnZXIuaW5mbygnQ3JlYXRpbmcgTW9tZW50byBDYWNoZUNsaWVudCcpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBuZXcgaW5zdGFuY2Ugb2YgQ2FjaGVDbGllbnQuIElmIGVhZ2VyQ29ubmVjdFRpbWVvdXQgaXMgcHJlc2VudCBpbiB0aGUgZ2l2ZW4gcHJvcHMsIHRoZSBjbGllbnQgd2lsbFxuICAgKiBlYWdlcmx5IGNyZWF0ZSBpdHMgY29ubmVjdGlvbiB0byBNb21lbnRvLiBJdCB3aWxsIHdhaXQgdW50aWwgdGhlIGNvbm5lY3Rpb24gaXMgZXN0YWJsaXNoZWQsIG9yIHVudGlsIHRoZSB0aW1vdXRcbiAgICogcnVucyBvdXQuIEl0IHRoZSB0aW1lb3V0IHJ1bnMgb3V0LCB0aGUgY2xpZW50IHdpbGwgYmUgdmFsaWQgdG8gdXNlLCBidXQgaXQgbWF5IHN0aWxsIGJlIGNvbm5lY3RpbmcgaW4gdGhlIGJhY2tncm91bmQuXG4gICAqIEBwYXJhbSB7RWFnZXJDYWNoZUNsaWVudFByb3BzfSBwcm9wcyBjb25maWd1cmF0aW9uIGFuZCBjcmVkZW50aWFscyBmb3IgY3JlYXRpbmcgYSBDYWNoZUNsaWVudC5cbiAgICovXG4gIHN0YXRpYyBhc3luYyBjcmVhdGUocHJvcHM6IEVhZ2VyQ2FjaGVDbGllbnRQcm9wcyk6IFByb21pc2U8Q2FjaGVDbGllbnQ+IHtcbiAgICBjb25zdCBjbGllbnQgPSBuZXcgQ2FjaGVDbGllbnQocHJvcHMpO1xuICAgIGNvbnN0IHRpbWVvdXQgPVxuICAgICAgcHJvcHMuZWFnZXJDb25uZWN0VGltZW91dCAhPT0gdW5kZWZpbmVkXG4gICAgICAgID8gcHJvcHMuZWFnZXJDb25uZWN0VGltZW91dFxuICAgICAgICA6IEVBR0VSX0NPTk5FQ0lUT05fREVGQVVMVF9USU1FT1VUX1NFQ09ORFM7XG4gICAgLy8gY2xpZW50IG5lZWQgdG8gZXhwbGljaXRseSBzZXQgdGhlIHZhbHVlIGFzIDAgdG8gZGlzYWJsZSBlYWdlciBjb25uZWN0aW9uLlxuICAgIGlmIChwcm9wcy5lYWdlckNvbm5lY3RUaW1lb3V0ICE9PSAwKSB7XG4gICAgICBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgY2xpZW50LmRhdGFDbGllbnRzLm1hcChkYyA9PiAoZGMgYXMgRGF0YUNsaWVudCkuY29ubmVjdCh0aW1lb3V0KSlcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiBjbGllbnQ7XG4gIH1cblxuICAvKipcbiAgICogRmx1c2hlcyAvIGNsZWFycyBhbGwgdGhlIGl0ZW1zIG9mIHRoZSBnaXZlbiBjYWNoZVxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gY2FjaGVOYW1lIC0gVGhlIGNhY2hlIHRvIGJlIGZsdXNoZWQuXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPENhY2hlRmx1c2guUmVzcG9uc2U+fSAtXG4gICAqIHtAbGluayBDYWNoZUZsdXNoLlN1Y2Nlc3N9IG9uIHN1Y2Nlc3MuXG4gICAqIHtAbGluayBDYWNoZUZsdXNoLkVycm9yfSBvbiBmYWlsdXJlLlxuICAgKi9cbiAgcHVibGljIGFzeW5jIGZsdXNoQ2FjaGUoY2FjaGVOYW1lOiBzdHJpbmcpOiBQcm9taXNlPENhY2hlRmx1c2guUmVzcG9uc2U+IHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5ub3RZZXRBYnN0cmFjdGVkQ29udHJvbENsaWVudC5mbHVzaENhY2hlKGNhY2hlTmFtZSk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIE1vbWVudG8gc2lnbmluZyBrZXkuXG4gICAqXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB0dGxNaW51dGVzIC0gVGhlIHRpbWUgdG8gbGl2ZSBpbiBtaW51dGVzIHVudGlsIHRoZSBNb21lbnRvXG4gICAqIHNpZ25pbmcga2V5IGV4cGlyZXMuXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPENyZWF0ZVNpZ25pbmdLZXkuUmVzcG9uc2U+fSAtXG4gICAqIHtAbGluayBDcmVhdGVTaWduaW5nS2V5LlN1Y2Nlc3N9IGNvbnRhaW5pbmcgdGhlIGtleSwga2V5IElELCBlbmRwb2ludCwgYW5kXG4gICAqIGV4cGlyYXRpb24gZGF0ZSBvbiBzdWNjZXNzLlxuICAgKiB7QGxpbmsgQ3JlYXRlU2lnbmluZ0tleS5FcnJvcn0gb24gZmFpbHVyZS5cbiAgICovXG4gIHB1YmxpYyBhc3luYyBjcmVhdGVTaWduaW5nS2V5KFxuICAgIHR0bE1pbnV0ZXM6IG51bWJlclxuICApOiBQcm9taXNlPENyZWF0ZVNpZ25pbmdLZXkuUmVzcG9uc2U+IHtcbiAgICBjb25zdCBjbGllbnQgPSB0aGlzLmdldE5leHREYXRhQ2xpZW50KCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMubm90WWV0QWJzdHJhY3RlZENvbnRyb2xDbGllbnQuY3JlYXRlU2lnbmluZ0tleShcbiAgICAgIHR0bE1pbnV0ZXMsXG4gICAgICBjbGllbnQuZ2V0RW5kcG9pbnQoKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogUmV2b2tlcyBhIE1vbWVudG8gc2lnbmluZyBrZXkuXG4gICAqXG4gICAqIEByZW1hcmtzXG4gICAqIEFsbCB0b2tlbnMgc2lnbmVkIGJ5IHRoaXMga2V5IHdpbGwgYmUgaW52YWxpZC5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGtleUlkIC0gVGhlIElEIG9mIHRoZSBrZXkgdG8gcmV2b2tlLlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxSZXZva2VTaWduaW5nS2V5LlJlc3BvbnNlPn0gLVxuICAgKiB7QGxpbmsgUmV2b2tlU2lnbmluZ0tleS5TdWNjZXNzfSBvbiBzdWNjZXNzLlxuICAgKiB7QGxpbmsgUmV2b2tlU2lnbmluZ0tleS5FcnJvcn0gb24gZmFpbHVyZS5cbiAgICovXG4gIHB1YmxpYyBhc3luYyByZXZva2VTaWduaW5nS2V5KFxuICAgIGtleUlkOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxSZXZva2VTaWduaW5nS2V5LlJlc3BvbnNlPiB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMubm90WWV0QWJzdHJhY3RlZENvbnRyb2xDbGllbnQucmV2b2tlU2lnbmluZ0tleShrZXlJZCk7XG4gIH1cblxuICAvKipcbiAgICogTGlzdHMgYWxsIE1vbWVudG8gc2lnbmluZyBrZXlzIGZvciB0aGUgcHJvdmlkZWQgYXV0aCB0b2tlbi5cbiAgICpcbiAgICogQHJldHVybnMge1Byb21pc2U8TGlzdFNpZ25pbmdLZXlzLlJlc3BvbnNlPn0gLVxuICAgKiB7QGxpbmsgTGlzdFNpZ25pbmdLZXlzLlN1Y2Nlc3N9IGNvbnRhaW5pbmcgdGhlIGtleXMgb24gc3VjY2Vzcy5cbiAgICoge0BsaW5rIExpc3RTaWduaW5nS2V5cy5FcnJvcn0gb24gZmFpbHVyZS5cbiAgICovXG4gIHB1YmxpYyBhc3luYyBsaXN0U2lnbmluZ0tleXMoKTogUHJvbWlzZTxMaXN0U2lnbmluZ0tleXMuUmVzcG9uc2U+IHtcbiAgICBjb25zdCBjbGllbnQgPSB0aGlzLmdldE5leHREYXRhQ2xpZW50KCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMubm90WWV0QWJzdHJhY3RlZENvbnRyb2xDbGllbnQubGlzdFNpZ25pbmdLZXlzKFxuICAgICAgY2xpZW50LmdldEVuZHBvaW50KClcbiAgICApO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldE5leHREYXRhQ2xpZW50KCk6IERhdGFDbGllbnQge1xuICAgIGNvbnN0IGNsaWVudCA9IHRoaXMuZGF0YUNsaWVudHNbdGhpcy5uZXh0RGF0YUNsaWVudEluZGV4XTtcbiAgICB0aGlzLm5leHREYXRhQ2xpZW50SW5kZXggPVxuICAgICAgKHRoaXMubmV4dERhdGFDbGllbnRJbmRleCArIDEpICUgdGhpcy5kYXRhQ2xpZW50cy5sZW5ndGg7XG4gICAgcmV0dXJuIGNsaWVudCBhcyBEYXRhQ2xpZW50O1xuICB9XG59XG5cbi8qKlxuICogQGRlcHJlY2F0ZWQgdXNlIHtDYWNoZUNsaWVudH0gaW5zdGVhZFxuICovXG5leHBvcnQgY2xhc3MgU2ltcGxlQ2FjaGVDbGllbnQgZXh0ZW5kcyBDYWNoZUNsaWVudCB7fVxuIl19